<div class="card mt-3">
  <div class="card-header bg-white py-3">
    <div class="d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Author Management</h5>
      <button class="btn btn-primary" (click)="openAddAuthorModal()">
        <i class="fas fa-plus me-1"></i> Add New Author
      </button>
    </div>
  </div>
  <div class="card-body">
    <ngx-datatable
      class="material"
      [rows]="authorService.data.items"
      [count]="authorService.data.totalCount"
      [columnMode]="'force'"
      [externalPaging]="true"
      [limit]="authorService.list.maxResultCount"
      [footerHeight]="50"
      [headerHeight]="50"
      [rowHeight]="60"
      (page)="onChangePage($event)"
      [trackByProp]="'id'"
      [externalSorting]="false"
    >
      <!-- Name column -->
      <ngx-datatable-column name="Name" prop="name" [sortable]="true">
        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
          <strong>{{ value }}</strong>
        </ng-template>
      </ngx-datatable-column>

      <!-- Birthdate column -->
      <ngx-datatable-column name="Birthdate" prop="birthdate" [sortable]="true" width="150">
        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
          {{ value | date: 'dd/MM/yyyy' }}
        </ng-template>
      </ngx-datatable-column>

      <!-- Short Bio column -->
      <ngx-datatable-column name="Short Bio" prop="shortBio" [sortable]="true">
        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
          {{ value }}
        </ng-template>
      </ngx-datatable-column>

      <!-- Actions column -->
      <ngx-datatable-column name="Actions" [sortable]="false" [canAutoResize]="false" width="120">
        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
          <div class="d-flex gap-2">
            <button class="btn btn-sm btn-primary" (click)="editAuthor(row)" title="Edit Author">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteAuthor(row)" title="Delete Author">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </ng-template>
      </ngx-datatable-column>
    </ngx-datatable>
  </div>
</div>

<!-- Add Author Modal -->
<ng-template #addAuthorModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title">{{ editingAuthorId ? 'Edit Author' : 'Add New Author' }}</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="authorForm">
      <div class="mb-3">
        <label for="name" class="form-label">Author Name</label>
        <input type="text" class="form-control" id="name" formControlName="name" required />
      </div>
      <div class="mb-3">
        <label for="birthDate" class="form-label">Birthdate</label>
        <input
          type="date"
          class="form-control"
          id="birthDate"
          formControlName="birthDate"
          required
        />
      </div>
      <div class="mb-3">
        <label for="shortBio" class="form-label">Short Bio</label>
        <textarea class="form-control" id="shortBio" formControlName="shortBio" rows="3"></textarea>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
    <button
      type="button"
      class="btn btn-primary"
      (click)="saveAuthor(modal)"
      [disabled]="!authorForm.valid"
    >
      Save
    </button>
  </div>
</ng-template>
